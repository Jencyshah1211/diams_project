{% extends "base.html" %} {% block content %}
<section class="page">
  <div id="loading" class="hidden">Loading...</div>
  <div id="error" class="hidden"></div>
  <div id="filterSummary"></div>

  <div class="sort-container">
    <div class="sort-group">
      <label for="sortBy">Sort By:</label>
      <select id="sortBy" name="sort_by">
        <option value="amount_asc">Price: Low to High</option>
        <option value="price_desc">Price: High to Low</option>
      </select>
    </div>
    <button id="filterBtn" class="search-btn">Filter</button>
  </div>

  <div class="diamond-filters hidden">
    <div class="type-toggle">
      <button id="btnNatural" class="active" onclick="toggleForm('natural')">
        NATURAL
      </button>
      <button id="btnLab" onclick="toggleForm('lab')">LAB GROWN</button>
    </div>

    <!-- Filters Section -->
    <div class="diamond-filters">
      <!-- NATURAL Form -->
      <div id="formNatural" class="filter-form">
        <form method="GET" action="/diamonds/filter" class="filter-container">
          <input
            type="hidden"
            name="diamond_type"
            id="diamondTypeNatural"
            value="natural"
          />

          <!-- Shape Filter -->
          <div class="filter-row shape-filter">
            <label>Shape:</label>
            <div class="shape-buttons">
              {% for shape in "Round Oval Princess Emerald Radiant Cushion Pear
              Marquise Asscher Heart".split() %}
              <button
                type="button"
                onclick="setValue('shapeInput', '{{ shape|lower }}')"
                class="shape-btn"
                data-shape="{{ shape|lower }}"
              >
                <img
                  src="/static/images/{{ shape|lower }}.png"
                  alt="{{ shape }}"
                />
                <span>{{ shape }}</span>
              </button>
              {% endfor %}
            </div>
            <input type="hidden" name="shape" id="shapeInput" />
          </div>

          <!-- Carat Filter -->
          <div class="filter-row range-filter">
            <label>Carat:</label>
            <div class="range-inputs">
              <input
                type="number"
                step="0.01"
                name="carat_min"
                id="caratMinNatural"
                placeholder="From"
              />
              <input
                type="number"
                step="0.01"
                name="carat_max"
                id="caratMaxNatural"
                placeholder="To"
              />
            </div>
            <div class="slider-container">
              <input
                type="range"
                min="-10"
                max="10"
                step="0.01"
                id="caratSliderMinNatural"
                class="range-slider"
              />
              <input
                type="range"
                min="-10"
                max="10"
                step="0.01"
                id="caratSliderMaxNatural"
                class="range-slider"
              />
            </div>
          </div>

          <!-- Color Filter -->
          <div class="filter-row">
            <label>Color:</label>
            <div class="button-group">
              <button
                type="button"
                onclick="setValue('colorType', 'white')"
                class="color-type-btn"
              >
                White
              </button>
              <button
                type="button"
                onclick="setValue('colorType', 'fancy')"
                class="color-type-btn"
              >
                Fancy
              </button>
            </div>
            <div class="color-buttons button-group">
              {% for c in "D E F G H I J K L M N O-P Q-R S-T U-V W-X
              Y-Z".split() %}
              <button
                type="button"
                onclick="setValue('colorGrade', '{{ c }}')"
                class="color-grade-btn"
              >
                {{ c }}
              </button>
              {% endfor %}
            </div>
            <input type="hidden" name="color_type" id="colorType" />
            <input type="hidden" name="color_grade" id="colorGrade" />
          </div>

          <!-- Clarity Filter -->
          <div class="filter-row">
            <label>Clarity:</label>
            <div class="button-group">
              {% for clarity in "FL IF VVS1 VVS2 VS1 VS2 SI1 SI2".split() %}
              <button
                type="button"
                onclick="setValue('clarityInput', '{{ clarity }}')"
                class="clarity-btn"
              >
                {{ clarity }}
              </button>
              {% endfor %}
            </div>
            <input type="hidden" name="clarity" id="clarityInput" />
          </div>

          <!-- Certificate and Fluorescence Filter (Side by Side) -->
          <div class="filter-row compact-group">
            <div>
              <label>Certificate:</label>
              <div class="button-group">
                {% for cert in "Certified Non-Certified".split() %}
                <button
                  type="button"
                  onclick="setValue('certificateInput', '{{ cert }}')"
                  class="certificate-btn"
                >
                  {{ cert }}
                </button>
                {% endfor %}
              </div>
              <input type="hidden" name="certificate" id="certificateInput" />
            </div>
            <div>
              <label>Fluorescence:</label>
              <div class="button-group">
                {% for fluo in "None Faint Medium Strong V-Strong".split() %}
                <button
                  type="button"
                  onclick="setValue('fluorescenceInput', '{{ fluo }}')"
                  class="fluorescence-btn"
                >
                  {{ fluo }}
                </button>
                {% endfor %}
              </div>
              <input type="hidden" name="fluorescence" id="fluorescenceInput" />
            </div>
          </div>

          <!-- Make and Stock No Filter (Side by Side) -->
          <div class="filter-row compact-group">
            <div>
              <label>Make:</label>
              <div class="button-group">
                {% for make in "3EX EX-CUT 3VG+".split() %}
                <button
                  type="button"
                  onclick="setValue('makeInput', '{{ make }}')"
                  class="make-btn"
                >
                  {{ make }}
                </button>
                {% endfor %}
              </div>
              <input type="hidden" name="make" id="makeInput" />
            </div>
            <div>
              <label>Stock No:</label>
              <input type="text" name="stock_no" placeholder="Stock No." />
            </div>
          </div>

          <!-- Buttons -->
          <div class="button-row">
            <button type="submit" class="search-btn">Search Diamonds</button>
            <button
              type="button"
              onclick="resetForm('formLab')"
              class="clear-btn"
            >
              Clear All
            </button>
          </div>
        </form>
      </div>

      <!-- LAB GROWN Form -->
      <div id="formLab" class="filter-form hidden">
        <form method="GET" action="/diamonds/filter" class="filter-container">
          <input
            type="hidden"
            name="diamond_type"
            id="diamondTypeLab"
            value="lab"
          />

          <!-- Shape Filter -->
          <div class="filter-row shape-filter">
            <label>Shape:</label>
            <div class="shape-buttons">
              {% for shape in "Round Oval Princess Emerald Radiant Cushion Pear
              Marquise Asscher Heart".split() %}
              <button
                type="button"
                onclick="setValue('shapeInputLab', '{{ shape|lower }}')"
                class="shape-btn"
                data-shape="{{ shape|lower }}"
              >
                <img
                  src="/static/images/{{ shape|lower }}.png"
                  alt="{{ shape }}"
                />
                <span>{{ shape }}</span>
              </button>
              {% endfor %}
            </div>
            <input type="hidden" name="shape" id="shapeInputLab" />
          </div>

          <!-- Carat Filter -->
          <div class="filter-row range-filter">
            <label>Carat:</label>
            <div class="range-inputs">
              <input
                type="number"
                step="0.01"
                name="carat_min"
                id="caratMinLab"
                placeholder="From"
              />
              <input
                type="number"
                step="0.01"
                name="carat_max"
                id="caratMaxLab"
                placeholder="To"
              />
            </div>
            <div class="slider-container">
              <input
                type="range"
                min="-10"
                max="10"
                step="0.01"
                id="caratSliderMinLab"
                class="range-slider"
              />
              <input
                type="range"
                min="-10"
                max="10"
                step="0.01"
                id="caratSliderMaxLab"
                class="range-slider"
              />
            </div>
          </div>

          <!-- Color Filter -->
          <div class="filter-row">
            <label>Color:</label>
            <div class="button-group">
              <button
                type="button"
                onclick="setValue('colorTypeLab', 'white')"
                class="color-type-btn"
              >
                White
              </button>
            </div>
            <div class="color-buttons button-group">
              {% for c in "D E F G H I J K L M".split() %}
              <button
                type="button"
                onclick="setValue('colorGradeLab', '{{ c }}')"
                class="color-grade-btn"
              >
                {{ c }}
              </button>
              {% endfor %}
            </div>
            <input type="hidden" name="color_type" id="colorTypeLab" />
            <input type="hidden" name="color_grade" id="colorGradeLab" />
          </div>

          <!-- Clarity Filter -->
          <div class="filter-row">
            <label>Clarity:</label>
            <div class="button-group">
              {% for clarity in "VVS1 VVS2 VS1 VS2 SI1 SI2".split() %}
              <button
                type="button"
                onclick="setValue('clarityLab', '{{ clarity }}')"
                class="clarity-btn"
              >
                {{ clarity }}
              </button>
              {% endfor %}
            </div>
            <input type="hidden" name="clarity" id="clarityLab" />
          </div>

          <!-- Certificate and Fluorescence Filter (Side by Side) -->
          <div class="filter-row compact-group">
            <div>
              <label>Certificate:</label>
              <div class="button-group">
                {% for cert in "Certified Non-Certified".split() %}
                <button
                  type="button"
                  onclick="setValue('certificateLab', '{{ cert }}')"
                  class="certificate-btn"
                >
                  {{ cert }}
                </button>
                {% endfor %}
              </div>
              <input type="hidden" name="certificate" id="certificateLab" />
            </div>
            <div>
              <label>Fluorescence:</label>
              <div class="button-group">
                {% for fluo in "None Faint Medium Strong".split() %}
                <button
                  type="button"
                  onclick="setValue('fluorescenceLab', '{{ fluo }}')"
                  class="fluorescence-btn"
                >
                  {{ fluo }}
                </button>
                {% endfor %}
              </div>
              <input type="hidden" name="fluorescence" id="fluorescenceLab" />
            </div>
          </div>

          <!-- Make and Stock No Filter (Side by Side) -->
          <div class="filter-row compact-group">
            <div>
              <label>Make:</label>
              <div class="button-group">
                {% for make in "3EX EX-CUT".split() %}
                <button
                  type="button"
                  onclick="setValue('makeLab', '{{ make }}')"
                  class="make-btn"
                >
                  {{ make }}
                </button>
                {% endfor %}
              </div>
              <input type="hidden" name="make" id="makeLab" />
            </div>
            <div>
              <label>Stock No:</label>
              <input type="text" name="stock_no" placeholder="Stock No." />
            </div>
          </div>

          <!-- Buttons -->
          <div class="button-row">
            <button type="submit" class="search-btn">Search Diamonds</button>
            <button
              type="button"
              onclick="resetForm('formLab')"
              class="clear-btn"
            >
              Clear All
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="diamond-grid">
    <h2>Diamond Collection</h2>
    {% if diamonds %} {% for diamond in diamonds %}
    <div class="card">
      <img src="{{ diamond.image_url }}" alt="{{ diamond.shape }} diamond" />
      <h3>{{ diamond.shape }} Diamond</h3>
      <p>
        Carat: {{ diamond.carat }} | Color: {{ diamond.color }} | Clarity: {{
        diamond.clarity }} | Cut: {{ diamond.cut }}
      </p>
      <p><strong>â‚¹{{ diamond.amount }}</strong></p>
      <a href="/diamond/{{ diamond.id }}" class="view-details-btn"
        >View Details</a
      >
    </div>
    {% endfor %} {% else %}
    <p>No diamonds found.</p>
    {% endif %}
  </div>
</section>

<script>
  // Toggle between Natural and Lab Grown forms
  function toggleForm(type) {
    const formNatural = document.getElementById("formNatural");
    const formLab = document.getElementById("formLab");
    const btnNatural = document.getElementById("btnNatural");
    const btnLab = document.getElementById("btnLab");

    if (type === "natural") {
      formNatural.classList.remove("hidden");
      formLab.classList.add("hidden");
      btnNatural.classList.add("active");
      btnLab.classList.remove("active");
    } else {
      formLab.classList.remove("hidden");
      formNatural.classList.add("hidden");
      btnLab.classList.add("active");
      btnNatural.classList.remove("active");
    }
  }

  // Set value for hidden inputs and toggle active class on buttons
  function setValue(inputId, value, event = null) {
    const input = document.getElementById(inputId);
    if (!input) return;

    input.value = value;

    if (event) {
      const button = event.currentTarget;
      const filterRow = button.closest(".filter-row");

      if (filterRow) {
        // Remove active class from all buttons in the same group
        const buttons = filterRow.querySelectorAll("button");
        buttons.forEach((btn) => btn.classList.remove("active"));

        // Add active class to clicked button
        button.classList.add("active");
      }
    }
  }

  // Reset form to initial state
  function resetForm(formId) {
    const form = document.getElementById(formId)?.querySelector("form");
    if (!form) return;

    form.reset();

    // Remove active class from all buttons
    const buttons = form.querySelectorAll("button");
    buttons.forEach((btn) => btn.classList.remove("active"));

    // Clear hidden inputs (except diamond_type)
    const hiddenInputs = form.querySelectorAll('input[type="hidden"]');
    hiddenInputs.forEach((input) => {
      if (input.name !== "diamond_type") input.value = "";
    });
  }

  // Toggle filter form visibility
  function toggleFilterForm() {
    const filterSection = document.querySelector(".diamond-filters");
    const filterBtn = document.getElementById("filterBtn");

    if (filterSection && filterBtn) {
      filterSection.classList.toggle("hidden");
      filterBtn.textContent = filterSection.classList.contains("hidden")
        ? "Filter"
        : "Close Filter";

      // Show natural form by default when opening
      if (!filterSection.classList.contains("hidden")) {
        toggleForm("natural");
      }
    }
  }

  // Initialize
  document.addEventListener("DOMContentLoaded", function () {
    const filterBtn = document.getElementById("filterBtn");

    if (filterBtn) {
      // Add click event listener to filter button
      filterBtn.addEventListener("click", toggleFilterForm);
    }

    // Handle form submissions
    document.querySelectorAll(".filter-container").forEach((form) => {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        console.log("Form submitted:", new FormData(form));
        // Add your form submission logic here
      });
    });
  });
</script>
{% endblock %}
